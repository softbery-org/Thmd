<UserControl
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:Effects="clr-namespace:Thmd.Controls.Effects" x:Class="Thmd.Views.ProgressBarView"
             mc:Ignorable="d" d:DesignWidth="400" Height="30">
    <UserControl.Resources>
        <!-- Lighter orange for mouse-over -->

        <!-- Define the dark orange color -->
        <SolidColorBrush x:Key="DarkOrangeBrush" Color="#D35400"/>
        <SolidColorBrush x:Key="DarkBackgroundBrush" Color="#1F1F1F"/>
        <SolidColorBrush x:Key="BufferBrush" Color="#ff8c2f"/>
        <!-- Semi-transparent dark orange -->
        <SolidColorBrush x:Key="MouseOverBrush" Color="#FFA500"/>
        <!-- Styl dla ProgressBar -->
        <Style x:Key="DarkOrangeProgressBarStyle" TargetType="{x:Type ProgressBar}">
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" ShadowDepth="2" BlurRadius="5"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ProgressBar}">
                        <Grid>
                            <Border x:Name="PART_Track" 
                            Background="{StaticResource DarkBackgroundBrush}" 
                            CornerRadius="4" 
                            BorderThickness="1">
                                <Border.BorderBrush>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#D35400" Offset="0"/>
                                        <GradientStop Color="#FF8C2F" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.BorderBrush>
                                <Border.Effect>
                                    <DropShadowEffect ShadowDepth="2" BlurRadius="4" Opacity="0.2"/>
                                </Border.Effect>
                            </Border>
                            <Border x:Name="PART_Indicator" 
                            HorizontalAlignment="Left" 
                            Width="{TemplateBinding Value}" 
                            CornerRadius="4">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#FF8C2F" Offset="0"/>
                                        <GradientStop Color="#D35400" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.BorderBrush>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#B34700" Offset="0"/>
                                        <GradientStop Color="#E07B27" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.BorderBrush>
                                <Border BorderThickness="1"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for the popup text -->
        <Style x:Key="PopupTextStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="Background" Value="{StaticResource DarkBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource MouseOverBrush}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" ShadowDepth="2" BlurRadius="5"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Zanikanie oraz pojawianie się kontroleki -->
        <Storyboard x:Key="fadeOutProgessBar" FillBehavior="HoldEnd">
            <DoubleAnimation Storyboard.TargetName="_grid"  Storyboard.TargetProperty="Opacity" To="0.0" Duration="0:0:2" />
        </Storyboard>
        <Storyboard x:Key="fadeInProgressBar" FillBehavior="HoldEnd">
            <DoubleAnimation Storyboard.TargetName="_grid"   Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:4" />
        </Storyboard>
    </UserControl.Resources>

    <Grid x:Name="_grid" Height="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="3*"/>
        </Grid.RowDefinitions>
        <ProgressBar x:Name="_progressBar"
                     Minimum="{Binding Minimum, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" 
                     Maximum="{Binding Maximum, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" 
                     Value="{Binding Value, Mode=TwoWay}"
                     Style="{StaticResource DarkOrangeProgressBarStyle}"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch"
                     Grid.RowSpan="1" 
                     Grid.Row="2"/>
        <TextBlock x:Name="_progressText" 
                   Text="{Binding ProgressText, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" 
                   Foreground="{StaticResource MouseOverBrush}" 
                   VerticalAlignment="Center" 
                   HorizontalAlignment="Right" 
                   Margin="0,0,10,0" 
                   Grid.Row="2"
                   Grid.RowSpan="2">
            <TextBlock.Effect>
                <DropShadowEffect  ShadowDepth="2" BlurRadius="3" Opacity="0.3"/>
            </TextBlock.Effect>
        </TextBlock>

        <Rectangle x:Name="_rectangleBufforBar" 
           Opacity="0.7"
           VerticalAlignment="Stretch"
           HorizontalAlignment="Stretch"
           Grid.Row="0" 
           Grid.RowSpan="1">
            <Rectangle.Fill>
                <LinearGradientBrush StartPoint="1,0" EndPoint="0,0">
                    <GradientStop Color="#fff" Offset="0"/>
                    <GradientStop Color="#3F7300EC" Offset="1"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
            <Rectangle.Effect>
                <DropShadowEffect ShadowDepth="1" BlurRadius="3" Opacity="0.3"/>
            </Rectangle.Effect>
        </Rectangle>

        <Rectangle x:Name="_rectangleMouseOverPoint" 
           HorizontalAlignment="Left" 
           Width="3" 
           Margin="50,0,0,0" 
           VerticalAlignment="Stretch" Grid.Row="1">
            <Rectangle.Fill>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#FF4500" Offset="0"/>
                    <GradientStop Color="#E65100" Offset="1"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
            <Rectangle.Effect>
                <DropShadowEffect ShadowDepth="2" BlurRadius="3" Opacity="0.3"/>
            </Rectangle.Effect>
        </Rectangle>
        <Popup x:Name="_popup" 
               PlacementTarget="{Binding ElementName=_progressBar}" 
               Placement="Top" 
               AllowsTransparency="True" Grid.RowSpan="2">
            <StackPanel Background="#222" Orientation="Vertical">
                <Image x:Name="_popupImage" Width="160" Height="90" Stretch="UniformToFill" Visibility="Visible"/>
                <TextBlock x:Name="_popupText" 
                       Text="{Binding PopupText, RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}" 
                       Style="{StaticResource PopupTextStyle}"/>
            </StackPanel>
        </Popup>
    </Grid>
</UserControl>