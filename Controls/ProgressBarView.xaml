<UserControl x:Class="Thmd.Controls.ProgressBarView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="50" d:DesignWidth="400">
    <UserControl.Resources>
        <!-- Define the dark orange color -->
        <SolidColorBrush x:Key="DarkOrangeBrush" Color="#D35400"/>
        <SolidColorBrush x:Key="DarkBackgroundBrush" Color="#1F1F1F"/>
        <SolidColorBrush x:Key="BufferBrush" Color="#ff8c2f"/>
        <!-- Semi-transparent dark orange -->
        <SolidColorBrush x:Key="MouseOverBrush" Color="#FFA500"/>
        <!-- Lighter orange for mouse-over -->

        <!-- Styl dla ProgressBar -->
        <Style x:Key="DarkOrangeProgressBarStyle" TargetType="{x:Type ProgressBar}">
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" ShadowDepth="2" BlurRadius="5"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ProgressBar}">
                        <Grid>
                            <Border x:Name="PART_Track" 
                            Background="{StaticResource DarkBackgroundBrush}" 
                            CornerRadius="4" 
                            BorderThickness="1">
                                <Border.BorderBrush>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#D35400" Offset="0"/>
                                        <GradientStop Color="#FF8C2F" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.BorderBrush>
                                <Border.Effect>
                                    <DropShadowEffect ShadowDepth="2" BlurRadius="4" Opacity="0.2"/>
                                </Border.Effect>
                            </Border>
                            <Border x:Name="PART_Indicator" 
                            HorizontalAlignment="Left" 
                            Width="{TemplateBinding Value}" 
                            CornerRadius="4">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#FF8C2F" Offset="0"/>
                                        <GradientStop Color="#D35400" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.BorderBrush>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#B34700" Offset="0"/>
                                        <GradientStop Color="#E07B27" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.BorderBrush>
                                <Border BorderThickness="1"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style for the popup text -->
        <Style x:Key="PopupTextStyle" TargetType="TextBlock">
            <Setter Property="Background" Value="{StaticResource DarkBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource MouseOverBrush}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" ShadowDepth="2" BlurRadius="5"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Storyboard -->
        <Storyboard x:Key="fadeOutProgressBar" FillBehavior="HoldEnd">
            <DoubleAnimation Storyboard.TargetName="_grid"  Storyboard.TargetProperty="Opacity" To="0.0" Duration="0:0:2" />
        </Storyboard>
        <Storyboard x:Key="fadeInProgressBar" FillBehavior="HoldEnd">
            <DoubleAnimation Storyboard.TargetName="_grid"   Storyboard.TargetProperty="Opacity" To="1.0" Duration="0:0:4" />
        </Storyboard>
    </UserControl.Resources>

    <Grid x:Name="_grid" Height="20">
        <ProgressBar x:Name="_progressBar"
                     Minimum="{Binding Minimum, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                     Maximum="{Binding Maximum, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                     Value="50"
                     Style="{StaticResource DarkOrangeProgressBarStyle}"
                     Height="20"/>
        <TextBlock x:Name="_progressText" 
                   Text="{Binding ProgressText, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                   Foreground="{StaticResource MouseOverBrush}" 
                   VerticalAlignment="Center" 
                   HorizontalAlignment="Right" 
                   Margin="0,0,10,0"/>
        <Rectangle Name="_rectangleBufforBar" 
           HorizontalAlignment="Right" 
           Width="100" 
           Height="5" 
           Margin="0,-30,0,0" 
                   Opacity="0.7"
           VerticalAlignment="Center">
            <Rectangle.Fill>
                <LinearGradientBrush StartPoint="1,0" EndPoint="0,0">
                    <GradientStop Color="#FFFF" Offset="0"/>
                    <GradientStop Color="#3F7300EC" Offset="1"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
            <Rectangle.Effect>
                <DropShadowEffect ShadowDepth="1" BlurRadius="3" Opacity="0.3"/>
            </Rectangle.Effect>
        </Rectangle>
        <Rectangle Name="_rectangleMouseOverPoint" 
           HorizontalAlignment="Left" 
           Width="4" 
           Height="12" 
           Margin="100,0,0,0" 
           VerticalAlignment="Center">
            <Rectangle.Fill>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#FF4500" Offset="0"/>
                    <GradientStop Color="#E65100" Offset="1"/>
                </LinearGradientBrush>
            </Rectangle.Fill>
            <Rectangle.Effect>
                <DropShadowEffect ShadowDepth="1" BlurRadius="3" Opacity="0.3"/>
            </Rectangle.Effect>
        </Rectangle>
        <Popup x:Name="_popup" 
               PlacementTarget="{Binding ElementName=_progressBar}" 
               Placement="Top" 
               AllowsTransparency="True">
            <StackPanel Background="#222" Orientation="Vertical">
                <Image x:Name="_popupImage" Width="160" Height="90" Stretch="UniformToFill" Visibility="Visible"/>
                <TextBlock x:Name="_popupText" 
                       Text="{Binding PopupText, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                       Style="{StaticResource PopupTextStyle}"/>
            </StackPanel>
        </Popup>
    </Grid>
</UserControl>